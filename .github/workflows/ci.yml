# =============================================================================
# CONTINUOUS INTEGRATION - DEPLOYMENT CHECKS ONLY
# No linting, no testing - just verify deployment files
# =============================================================================

name: CI Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  PYTHON_VERSION: "3.10"

jobs:
  # ---------------------------------------------------------------------------
  # JOB: VERIFY DEPLOYMENT READINESS
  # ---------------------------------------------------------------------------
  verify-deployment:
    name: Verify Deployment Files
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Check deployment files
        run: |
          echo "✓ Checking deployment files..."

          # Check render.yaml
          if [ -f "render.yaml" ]; then
            echo "✓ render.yaml found"
          else
            echo "✗ render.yaml missing"
            exit 1
          fi

          # Check requirements.txt
          if [ -f "requirements.txt" ]; then
            echo "✓ requirements.txt found"
          else
            echo "✗ requirements.txt missing"
            exit 1
          fi

          # Check main API file (Renamed to app.py in root)
          if [ -f "app.py" ]; then
            echo "✓ API main file (app.py) found"
          else
            echo "✗ app.py missing in root directory"
            exit 1
          fi

      - name: Check model files
        run: |
          echo "✓ Checking model files..."

          # Check model
          if [ -f "models/optimized/model_final.pkl" ] || [ -f "models/optimized/model.json.gz" ]; then
            echo "✓ Model file found"
            ls -lh models/optimized/
          else
            echo "✗ Model file missing"
            exit 1
          fi

          # Check features
          if [ -f "models/optimized/features.txt" ]; then
            echo "✓ Features file found"
            wc -l models/optimized/features.txt
          else
            echo "✗ features.txt missing"
            exit 1
          fi

      - name: Verify Python syntax
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Quick import check
        run: |
          pip install -q fastapi uvicorn xgboost
          python -c "import fastapi; import uvicorn; import xgboost; print('✓ Core imports work')"
